<!DOCTYPE html>
<html>
	<head>
		<title>Pilot</title>
		<link rel='stylesheet' href='main.css' type='text/css' />
	</head>
	<body>
		<canvas id='viewscreen'>
		</canvas>
		<div id='space'>
		</div>
		<div id='controls'>
			<div id='console'>
				<div id='editor'>
					<textarea id='editor_body'></textarea><br/>
					<input type='button' id='editor_close' value='Close' />
					<input type='button' id='editor_save' value="Save" />
				</div>
				<div id='output'></div>
				<span id='PS1'>&gt;</span>
				<input type='text' id='prompt'/>
			</div>
			<canvas id='screen'>
			</canvas>
		</div>
		<div id='gameover'>
			GAME OVER.<br/>
			Refresh your browser to start again.
		</div>
		<script src="jquery.js"></script>
		<script src="three.js"></script>
		<script src="Octree.js"></script>
		<script src="ship.js"></script>
		<script src="starfield.js"></script>
		<script src="helper_functions.js"></script>
		<script>
		var ship,promptHistory = [],historyIndex,stardate;
		var help = "To start the tutorial, simply type 'ship.tutorial()'.  To get help on a particular function, call 'help()' on that function's object (e.g. editor.help() will show the help for the text editor).";
		Object.defineProperty(window,"hello",{
			get:function() {
				ship.log("Hi there.  Now, can we please get back to business?");
				return "";
			}
		});
			$(function() {
				ship = new Ship();
				ship.run();

				var clear = function() {
					$("#output").html("");
				}
				$("#prompt").focus();
				$("#prompt").on('keydown',function(e) {
					e = e || window.event;
					if(e.which == 13) {
						e.preventDefault();
						var result;
						$("#output").append("> " + $("#prompt").val() + "<br />");
						try {
							result = eval.call(window,$("#prompt").val());
						} catch(e) {
							$("#output").append("Error: " + e + "<br />");
						} finally {
							promptHistory.push($("#prompt").val());
							historyIndex = promptHistory.length - 1;
							$("#output").append(result + "<br />");
							$("#prompt").val("");
						}
					} else if(e.which == 40) {
						if(historyIndex == promptHistory.length -1 && $("#prompt").val() != "")
							promptHistory.push($("#prompt").val());
						if(historyIndex > 0) {
							$("#prompt").val(promptHistory[historyIndex]);
							historyIndex--;
						}
					} else if(e.which == 38) {
						if(historyIndex < promptHistory.length) {
							$("#prompt").val(promptHistory[historyIndex]);
							historyIndex--;
						}
					}
					if(historyIndex > promptHistory.length) historyIndex = promptHistory.length;
					if(historyIndex < 0) historyIndex = 0;
				});
				$("#console").on('click',function(e) {
					$("#prompt").focus();
				});
				$("#editor_save").on('click',function(e) {
					try {
						eval.call(window,$("#editor_body").val());
					} catch(e) {
						$("#output").append("Editor caused error: " + e + "<br />");
					} finally {
						// until we get around to emulating some sort of file system...
						$("#output").append("WARNING: Hard Disk Drive disconnected, code was run but may not have been saved.<br />");
					}
				});
				$("#editor_close").on('click',function(e) {
					// again, we need to automatically save when the editor is closed once saving becomes a thing
					// note that this is somewhat of a lie.  The chances are your browser cached the changes and they'll come back if you call "editor()" again.
					$("#output").append("WARNING: Editor closed.  Any changes you made since the last evaluation may have been lost.  Sorry about that. <br/>");
					$("#editor").hide();
					$("#output").show();
					$("#prompt").show();
					$("#PS1").show();
					$("#prompt").focus();
				});
			});
		</script>
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		  ga('create', 'UA-36309938-2', 'cjbrowne-pilot.herokuapp.com');
		  ga('send', 'pageview');

		</script>
	</body>
</html>